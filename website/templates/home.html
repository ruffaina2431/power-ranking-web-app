{% extends "base.html" %}
{% block title %}E-Sports Tournament Hub{% endblock %}
{% block content %}

<style>
.hero-section {
    background: linear-gradient(135deg, #132440 0%, #16476A 50%, #132440 100%);
    border: 2px solid #16476A;
    box-shadow: 0 0 20px rgba(191, 9, 47, 0.5);
    position: relative;
    overflow: hidden;
}
.hero-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="%23BF092F" opacity="0.1"/></svg>') repeat;
    opacity: 0.1;
}
.hero-title {
    font-size: 3rem;
    font-weight: bold;
    text-shadow: 0 0 10px #216799, 0 0 20px #16476A;
    color: #ffffff;
}
.hero-subtitle {
    font-size: 1.5rem;
    text-shadow: 0 0 5px #246b9e;
    color: #cccccc;
}
.rank-badge {
    display: inline-block;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(45deg, #BF092F, #3B9797);
    color: white;
    text-align: center;
    line-height: 40px;
    font-weight: bold;
    box-shadow: 0 0 10px rgba(191, 9, 47, 0.5);
}
.table-hover tbody tr:hover {
    background-color: rgba(0, 212, 255, 0.1);
    transition: all 0.3s ease;
}
.tournament-card {
    border: 1px solid #16476A;
    box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.tournament-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 60, 255, 0.5);
}
.tournament-header {
    background: linear-gradient(90deg, #BF092F, #3B9797);
    color: white;
}
.btn-glow {
    box-shadow: 0 0 10px rgba(68, 0, 255, 0.5);
    transition: box-shadow 0.3s ease;
}
.btn-glow:hover {
    box-shadow: 0 0 20px rgba(0, 47, 255, 0.8);
}
.search-card {
    border: 1px solid #16476A;
    box-shadow: 0 0 10px rgba(255, 0, 55, 0.692);
}
.rankings-card {
    border: 1px solid #16476A;
    box-shadow: 0 0 15px rgba(226, 8, 55, 0.63);
}
</style>

<script>
function changeCategory(category) {
    window.location.href = '?category=' + encodeURIComponent(category);
}

function searchGame() {
    var searchTerm = document.getElementById('gameSearch').value.trim();
    if (searchTerm) {
        // Store the current search term in session storage (original case for display)
        sessionStorage.setItem('lastSearchTerm', searchTerm);
        window.location.href = '?category=' + encodeURIComponent(searchTerm);
    } else {
        document.getElementById('searchFeedback').style.display = 'block';
        document.getElementById('searchFeedback').textContent = 'Please enter a game name to search';
        setTimeout(() => {
            document.getElementById('searchFeedback').style.display = 'none';
        }, 3000);
    }
}

function sortTable(sortBy) {
    var currentUrl = new URL(window.location);
    var currentSort = currentUrl.searchParams.get('sort');
    var currentOrder = currentUrl.searchParams.get('order') || 'asc';

    var newOrder = 'asc';
    if (currentSort === sortBy && currentOrder === 'asc') {
        newOrder = 'desc';
    }

    currentUrl.searchParams.set('sort', sortBy);
    currentUrl.searchParams.set('order', newOrder);
    window.location.href = currentUrl.toString();
}
</script>

<div class="container mt-4">
    <!-- Hero Section -->
    <div class="hero-section jumbotron text-center text-white py-4 mb-4">
        <div class="container-fluid ">
            <i class="fa fa-trophy fa-3x mb-3" style="color: #ffd000;"></i>
            <h1 class="hero-title">KDM E-Sports Tournament Power Rankings</h1>
            <p class="hero-subtitle">Compete in our upcoming tournaments and climb the ranks!</p>
        </div>
    </div>

    <!-- Game Search Section -->
    <div class="search-card card mb-4">
        <div class="card-header bg-primary text-white">
            <h3><i class="fa fa-search mr-2"></i>Search Game Categories</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <input type="text" class="form-control" id="gameSearch" placeholder="Enter game name (e.g., VALORANT, Mobile Legends)" onkeypress="if(event.key === 'Enter') searchGame()">
                </div>
                <div class="col-md-4">
                    <button type="button" class="btn btn-primary btn-block btn-glow" onclick="searchGame()"><i class="fa fa-search mr-2"></i>Search</button>
                </div>
            </div>
            <div class="mt-3">
                <p class="text-muted">Available categories: {% for cat in categories %}{{ cat }}{% if not loop.last %}, {% endif %}{% endfor %}</p>
                <div id="searchFeedback" class="alert alert-warning mt-2" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // Check for search results on page load
        document.addEventListener('DOMContentLoaded', function() {
            var lastSearchTerm = sessionStorage.getItem('lastSearchTerm');
            var teamsTable = document.querySelector('.table tbody');
            var noTeamsRow = teamsTable.querySelector('tr td[colspan="4"]');
            
            if (lastSearchTerm && noTeamsRow) {
                document.getElementById('searchFeedback').style.display = 'block';
                document.getElementById('searchFeedback').textContent = 'No teams found for "' + lastSearchTerm + '". Try checking the game name spelling or try a different game.';
                // Highlight available categories
                document.querySelector('.text-muted').style.fontWeight = 'bold';
                sessionStorage.removeItem('lastSearchTerm');
            } else if (lastSearchTerm) {
                sessionStorage.removeItem('lastSearchTerm');
            }

            // Set the search input value to the last search
            if (lastSearchTerm) {
                document.getElementById('gameSearch').value = lastSearchTerm;
            }
        });
    </script>

    <!-- Power Rankings Section -->
    <div id="rankings" class="rankings-card card mb-4">
        <div class="card-header bg-primary text-white">
            <h2><i class="fa fa-trophy mr-2"></i>Current Power Rankings - {{ current_category }}</h2>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover table-dark">
                    <thead class="thead-light">
                        <tr>
                            <th><a href="#" onclick="sortTable('rank')" class="text-dark">Rank {% if sort_by == 'rank' %}{% if order == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</a></th>
                            <th><a href="#" onclick="sortTable('name')" class="text-dark">Team Name {% if sort_by == 'name' %}{% if order == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</a></th>
                            <th><a href="#" onclick="sortTable('points')" class="text-dark">Points {% if sort_by == 'points' %}{% if order == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</a></th>
                            <th><a href="#" onclick="sortTable('wins')" class="text-dark">Tournament Wins {% if sort_by == 'wins' %}{% if order == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</a></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for team in teams %}
                        <tr>
                            <td>
                                {% if team.rank %}
                                    <span class="rank-badge">{{ team.rank }}</span>
                                {% else %}
                                    Unranked
                                {% endif %}
                            </td>
                            <td><strong>{{ team.name }}</strong></td>
                            <td><span class="text-warning">{{ team.points }}</span></td>
                            <td><span class="text-success">{{ team.wins }}</span></td>
                        </tr>
                        {% endfor %}
                        {% if not teams %}
                        <tr>
                            <td colspan="4" class="text-center text-muted">No teams found for this category.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Tournament Registration Section -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h2><i class="fa fa-calendar mr-2"></i>Upcoming Tournaments</h2>
        </div>
        <div class="card-body">
            {% if tournaments %}
            <div class="row">
                {% for tournament in tournaments %}
                <div class="col-md-6 mb-3">
                    <div class="tournament-card card h-100">
                        <div class="tournament-header card-header">
                            <h5><i class="fa fa-gamepad mr-2"></i>{{ tournament.name }}</h5>
                        </div>
                        <div class="card-body">
                            <h6 class="card-title"><i class="fa fa-calendar-alt mr-2"></i>{{ tournament.date.strftime('%B %d, %Y') }}</h6>
                            <p class="card-text">
                                <strong>Location:</strong> {{ tournament.location|title }}<br>
                                <strong>Max Players:</strong> {{ tournament.max_players }}<br>
                                <strong>Requirements:</strong>
                                <ul class="mb-2">
                                    <li>Complete team roster ({{ tournament.max_players }} players)</li>
                                    <li>Team name</li>
                                    <li>Team captain contact information</li>
                                </ul>
                            </p>
                            {% if current_user.is_authenticated %}
                            <a href="{{ url_for('views.team_create', game_name=tournament.game_name, tournament_location=tournament.location) }}" class="btn btn-glow btn-block" style="background: linear-gradient(90deg, #BF092F, #3B9797); border: none;">Create Team & Register</a>
                            {% else %}
                            <a href="/login" class="btn btn-glow btn-block" style="background: linear-gradient(90deg, #BF092F, #3B9797); border: none;">Login to Register</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center">
                <i class="fa fa-calendar-times fa-3x text-muted mb-3"></i>
                <p class="text-muted">No upcoming tournaments available at the moment.</p>
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('views.tournament_create') }}" class="btn btn-primary btn-glow">Create Tournament</a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>


</div>



{% endblock %}
